<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8">
<title>Il Mio Strava Wrapped 2025</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{margin:0;background:#fc5200;color:#fff;font-family:system-ui;text-align:center;padding:50px;line-height:1.8}
  h1{font-size:3em}
  .big{font-size:5.5em;font-weight:bold;margin:15px 0}
  .card{background:rgba(255,255,255,0.15);border-radius:25px;padding:30px;margin:20px auto;max-width:90%}
</style>
</head>
<body>
<h1>üèÉ‚Äç‚ôÇÔ∏è Il Mio 2025 su Strava</h1>
<div class="card">Caricamento‚Ä¶</div>

<script>
const CLIENT_ID = "189218";
const CLIENT_SECRET = "bc009f7ce923f271ce4254391ecddee128c77a71";
const REFRESH_TOKEN = "9a4e8d6c5b3f1e9d7c5b3f1e9d7c5b3f1e9d7c5b"; // token fresco di oggi

(async () => {
  try {
    const t = await (await fetch("https://www.strava.com/oauth/token",{
      method:"POST",headers:{"Content-Type":"application/json"},
      body:JSON.stringify({client_id:CLIENT_ID,client_secret:CLIENT_SECRET,grant_type:"refresh_token",refresh_token:REFRESH_TOKEN})
    })).json();

    const start = Math.floor(new Date("2025-01-01").getTime()/1000);
    let a = [], p = 1;
    while(true){
      const d = await (await fetch(`https://www.strava.com/api/v3/athlete/activities?after=\( {start}&per_page=200&page= \){p}`,{
        headers:{Authorization:"Bearer "+t.access_token}
      })).json();
      if(!d||d.length===0)break;
      a = a.concat(d);
      if(d.length<200)break;
      p++;
    }

    const km = (a.reduce((x,y)=>x+y.distance,0)/1000).toFixed(1);
    const h = Math.floor(a.reduce((x,y)=>x+y.moving_time,0)/3600);
    const m = Math.floor((a.reduce((x,y)=>x+y.moving_time,0)%3600)/60);
    const elev = a.reduce((x,y)=>x+(y.total_elevation_gain||0),0).toFixed(0);

    document.body.innerHTML = `
      <h1>Il tuo 2025</h1>
      <div class="card"><div class="big">${a.length}</div><small>attivit√†</small></div>
      <div class="card"><div class="big">${km}</div><small>km</small></div>
      <div class="card"><div class="big">\( {h}h \){m}m</div><small>in movimento</small></div>
      <div class="card"><div class="big">${elev}</div><small>m+</small></div>
      <h1>üî• LEGGENDARIO!</h1>`;
  } catch(e){
    document.body.innerHTML = "<div class='card' style='background:#e31c1c'><h2>Errore</h2><p>Ricarica la pagina</p></div>";
  }
})();
</script>
</body>
</html>